{% extends "main/base.html" %}
{% load static %}

{% block title %}Create Your Account - MAJD{% endblock %}

{% block fileStyle %}
<link rel="stylesheet" href="{% static 'css/accounts.css' %}">
{% endblock %}

{% block content %}
<section class="register-container">
  <div class="container">
    <div class="row justify-content-center text-start">
      <div class="col-md-8 col-lg-6">
        <div class="register-form">

          <!-- Header -->
          <div class="text-center mb-4">
            <div class="role-icon mx-auto mb-3">
              <i class="bi bi-person-plus-fill"></i>
            </div>
            <h1 class="form-title">Create Your Account</h1>
            <p class="subtitle">Complete your account setup to access your personalized dashboard</p>

            <div class="progress-dashes">
              <div class="progress-dash active"></div>
              <div class="progress-dash"></div>
            </div>
          </div>

          <!-- Selected Role (optional) -->
          {% if pre_selected_role %}
          <div class="selected-role-display mb-4">
            <div class="d-flex align-items-center">
              <div class="selected-role-icon me-3">
                <i class="bi bi-people-fill"></i>
              </div>
              <div>
                <div class="selected-role-label">Selected Role</div>
                <div class="selected-role-value">
                  {% if pre_selected_role == "academy_admin" %}Academy Admin
                  {% elif pre_selected_role == "trainer" %}Trainer
                  {% else %}Parent{% endif %}
                </div>
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Messages -->
          {% if messages %}
          <div class="messages">
            {% for message in messages %}
              <div class="alert
                  {% if 'error' in message.tags or 'danger' in message.tags %}alert-danger
                  {% elif 'success' in message.tags %}alert-success
                  {% else %}alert-info{% endif %}
                  alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          </div>
          {% endif %}

          <!-- Form -->
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- Username -->
            <div class="form-group">
              <label class="form-label">Username <span class="text-danger">*</span></label>
              <input type="text" name="username" class="form-control" placeholder="Enter username" required
                     value="{{ request.POST.username|default:'' }}">
            </div>

            <!-- First Name -->
            <div class="form-group">
              <label class="form-label">First Name <span class="text-danger">*</span></label>
              <input type="text" name="first_name" class="form-control" placeholder="Enter first name" required
                     value="{{ request.POST.first_name|default:'' }}">
            </div>

            <!-- Last Name -->
            <div class="form-group">
              <label class="form-label">Last Name</label>
              <input type="text" name="last_name" class="form-control" placeholder="Enter last name"
                     value="{{ request.POST.last_name|default:'' }}">
            </div>

            <!-- Email -->
            <div class="form-group">
              <label class="form-label">Email Address <span class="text-danger">*</span></label>
              <input type="email" name="email" class="form-control" placeholder="name@example.com" required
                     value="{{ request.POST.email|default:'' }}">
            </div>

            {% if pre_selected_role == "trainer" or request.POST.user_type == "trainer" %}
            <!-- Profile Image -->
            <div class="form-group">
              <label class="form-label">Profile Image</label>
              <input type="file" name="profile_image" class="form-control">
            </div>
            {% endif %}

            <!-- Password -->
            <div class="form-group">
              <label class="form-label">Password <span class="text-danger">*</span></label>
              <div class="position-relative">
                <input type="password" name="password1" id="password1" class="form-control" placeholder="••••••••" required>
                <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y password-toggle" style="z-index:10;">
                  <i class="bi bi-eye"></i>
                </button>
              </div>
            </div>

            <!-- Confirm Password -->
            <div class="form-group">
              <label class="form-label">Confirm Password <span class="text-danger">*</span></label>
              <div class="position-relative">
                <input type="password" name="password2" id="password2" class="form-control" placeholder="Repeat password" required>
                <button type="button" class="btn btn-link position-absolute end-0 top-50 translate-middle-y password-toggle" style="z-index:10;">
                  <i class="bi bi-eye"></i>
                </button>
              </div>
            </div>

            <!-- Role -->
            {% if pre_selected_role %}
              <input type="hidden" name="user_type" value="{{ pre_selected_role }}">
            {% else %}
            <div class="form-group">
              <label class="form-label">Account Type <span class="text-danger">*</span></label>
              <select name="user_type" class="form-select" required>
                <option value="">— Select —</option>
                <option value="academy_admin" {% if request.POST.user_type == "academy_admin" %}selected{% endif %}>Academy Admin</option>
                <option value="trainer" {% if request.POST.user_type == "trainer" %}selected{% endif %}>Trainer</option>
                <option value="parent" {% if request.POST.user_type == "parent" %}selected{% endif %}>Parent</option>
              </select>
            </div>
            {% endif %}

            <!-- Terms -->
            <div class="form-group">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="terms" name="terms" value="1" required>
                       {% if request.POST.terms %}checked{% endif %}
                <label class="form-check-label" for="terms">
                  I agree to the <a href="#" class="terms-link">Terms of Service</a> and <a href="#" class="terms-link">Privacy Policy</a>
                </label>
              </div>
            </div>

            <button type="submit" class="submit-btn">
              <i class="bi bi-person-plus me-2"></i>
              Create Account
            </button>
          </form>

          <div class="login-link mt-3">
            <p class="mb-0">Already have an account?
              <a href="{% url 'accounts:login_view' %}">Sign in</a>
            </p>
          </div>

        </div>
      </div>
    </div>
  </div>
</section>

<script>
document.querySelectorAll('.password-toggle').forEach(btn => {
  btn.addEventListener('click', function() {
    const input = this.previousElementSibling;
    const icon = this.querySelector('i');
    if (input.type === 'password') {
      input.type = 'text';
      icon.classList.remove('bi-eye');
      icon.classList.add('bi-eye-slash');
    } else {
      input.type = 'password';
      icon.classList.remove('bi-eye-slash');
      icon.classList.add('bi-eye');
    }
  });
});
</script>
{% endblock %}
