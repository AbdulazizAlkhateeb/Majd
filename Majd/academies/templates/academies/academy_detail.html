{% extends "main/base.html" %}
{% load static %}
{% load dict_extras %}

{% block title %} {{academy.name}} {% endblock %}

{% block content %}
<!-- 🌟 Hero Section with Stats -->
<section class="position-relative text-white" style="height: 75vh; background: url('{{ academy.cover.url }}') center/cover no-repeat;">
  <div class="position-absolute top-0 start-0 w-100 h-100" style="background: rgba(0,0,0,0.55);"></div>

  <!-- Back Button -->
  <div class="position-absolute top-0 start-0 m-4" style="z-index: 2;">
    <a href="{% url 'academies:list' %}" class="text-white text-decoration-none d-flex align-items-center">
      <i class="bi bi-arrow-left me-2"></i> Back to Academies
    </a>
  </div>

  <!-- Hero Content -->
  <div class="position-relative d-flex flex-column justify-content-center align-items-start h-100 w-100 px-5">
    <div class="d-flex align-items-center mb-4">
      {% if academy.logo %}
      <img src="{{ academy.logo.url }}" class="rounded-circle me-3 shadow-lg" style="width: 90px; height: 90px; object-fit: cover;">
      {% endif %}
      <div>
        <span class="badge bg-success mb-2 px-3 py-2 fs-6">{{ academy.programs.first.sport_type|title }}</span>
        <h1 class="fw-bold display-4 mb-1">{{ academy.name }}</h1>
        {% if academy.tagline %}
        <p class="lead fs-4">{{ academy.tagline }}</p>
        {% endif %}
      </div>
    </div>

    <!-- Quick Info -->
    <div class="mb-4 d-flex flex-wrap align-items-center gap-4 fs-5">
      <span><i class="bi bi-geo-alt"></i> {{ academy.city }}</span>
      <span><i class="bi bi-star-fill text-warning"></i> {{ fake_rating }}/5 Rating</span>
      <span><i class="bi bi-people"></i> {{ active_students }}+ Students</span>
      <span><i class="bi bi-calendar-check"></i> {{ years_experience }}+ Years</span>
      <span><i class="bi bi-book"></i> {{ academy.programs.count }} Programs</span>
    </div>

    <p class="mb-4 fs-5" style="max-width: 750px;">{{ academy.description }}</p>

    <div>
      <a href="#subscriptions" class="btn btn-success btn-lg me-3 px-4 py-2">Join Academy Now</a>
      <a href="#programs" class="btn btn-outline-light btn-lg px-4 py-2">View Programs</a>
    </div>
  </div>
</section>


<!-- ✅ Success Message -->
{% if is_subscribed %}
<section class="container py-3">
  <div class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="bi bi-check-circle-fill me-2"></i>
    <strong>Great!</strong> You are subscribed to {{ academy.name }}. You can now enroll your children in any of the programs below.
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
</section>
{% endif %}

<!-- 🌍 Mission Section -->
<section class="py-5 bg-success text-white text-center">
  <div class="container">
    <h3 class="fw-bold">Our Mission</h3>
    <p class="lead">
      To provide world-class sports education that develops not just skilled players,
      but confident, disciplined, and passionate athletes who excel both on and off the field.
    </p>
  </div>
</section>

<!-- 🎓 Training Programs Section -->
<section id="programs" class="container py-5">
  <div class="text-center mb-5">
    <h2 class="fw-bold text-success">Training Programs</h2>
    <p class="text-muted">Choose from our comprehensive range of programs designed to develop skills at every level.</p>
  </div>

  <div class="row g-4">
    {% for program in programs %}
    <div class="col-md-4">
      <div class="program-card h-100 text-white d-flex flex-column justify-content-end"
           style="background-image: url('{{ program.image.url }}');">

        <div class="program-overlay p-3 rounded-3">
          <h5 class="fw-bold">{{ program.title }}</h5>
          <p class="small mb-2">{{ program.short_description|default:"No description provided." }}</p>

          <ul class="list-unstyled small mb-3">
            <li><i class="bi bi-calendar-event me-1"></i> Sessions: {{ program.sessions_count }}</li>
            <li><i class="bi bi-people me-1"></i> Players: {{ program.players_count }}</li>
          </ul>

          <div class="d-grid gap-2">
            <a href="{% url 'academies:join_program_view' academy.slug program.id %}" 
               class="btn btn-success btn-sm fw-semibold">Enroll Children</a>
            <a href="{% url 'academies:program_sessions' academy.slug program.id %}" 
               class="btn btn-outline-light btn-sm">
              <i class="bi bi-calendar-event me-1"></i> View Sessions
            </a>
          </div>
        </div>
      </div>
    </div>
    {% empty %}
    <p class="text-center text-muted">No programs available for this academy yet.</p>
    {% endfor %}
  </div>
</section>

<!-- 🏆 Top Coaches Section -->
<section class="container py-5">
  <div class="text-center mb-5">
    <h2 class="fw-bold text-success">Top Coaches</h2>
    <p class="text-muted">Meet our highly qualified and experienced coaching team.</p>
  </div>

  <div class="row g-4">
    {% for coach in coaches %}
    <div class="col-md-4">
      <div class="card-pricing h-100 text-center">
        {% if coach.profile_image %}
        <img src="{{ coach.profile_image.url }}" class="rounded-circle mx-auto mb-3 shadow-sm" width="100" height="100" style="object-fit:cover;">
        {% endif %}
        <h5 class="plan-title">{{ coach.user.get_full_name }}</h5>
        <p class="plan-subtitle">{{ coach.position }}</p>
        <ul class="plan-features">
          <li><i class="bi bi-trophy text-success"></i> Sport: {{ coach.specialty }}</li>
          <li><i class="bi bi-award text-success"></i> Licenses: {{ coach.certifications|default:"N/A" }}</li>
        </ul>
      </div>
    </div>
    {% empty %}
    <p class="text-center text-muted">No coaches added yet.</p>
    {% endfor %}
  </div>
</section>

<!-- 💳 Subscription Plans Section -->
<section id="subscriptions" class="py-5">
  <div class="container text-center mb-5">
    <h2 class="fw-bold mb-2">Choose Your Academy Plan</h2>
    <p class="text-muted mb-4">Select the perfect subscription plan for {{ academy.name }}. Upgrade or downgrade at any time.</p>
  </div>

  <div class="container">
    <div class="row g-4 justify-content-center">
      {% for plan in subscription_plans %}
      <div class="col-md-6 col-lg-4">
        <div class="card-pricing h-100 {% if plan.is_active %}featured{% endif %}">
          {% if forloop.first %}
          <div class="most-popular">Most Popular</div>
          {% endif %}
          <div class="plan-icon bg-soft-success">
            <i class="bi {{ plan.plan_type.icon_class|default:'bi-star' }}"></i>
          </div>
          <h5 class="plan-title">{{ plan.title }}</h5>
          <p class="plan-subtitle">{{ plan.description|default:"Great plan for your academy" }}</p>
          <div class="plan-price">
            <span class="currency">SAR</span>
            <span class="amount">{{ plan.price }}</span>
            <span class="per">/{{ plan.get_billing_type_display }}</span>
          </div>
          <ul class="plan-features">
            {% if plan.program_features %}
            {% for feature in plan.program_features %}
            <li><i class="bi bi-check-circle text-success"></i> {{ feature }}</li>
            {% endfor %}
            {% endif %}
          </ul>
          {% if is_subscribed %}
          <button class="btn btn-success w-100" disabled>
            <i class="bi bi-check-circle me-1"></i> Already Subscribed
          </button>
          {% else %}
          <a href="{% url 'academies:subscription_enroll_redirect' academy.slug plan.id %}" class="btn btn-success w-100">Get Started</a>
          {% endif %}
        </div>
      </div>
      {% empty %}
      <div class="col-12 text-center">
        <p class="text-muted">No subscription plans available for this academy yet.</p>
      </div>
      {% endfor %}
    </div>
  </div>
</section>

<style>
  #subscriptions h2, #programs h2, .container h2 { color: #155d4a; font-weight: 600; }

  /* Program cards with background image */
  .program-card {
    background-size: cover;
    background-position: center;
    border-radius: 14px;
    position: relative;
    overflow: hidden;
    min-height: 480px;
    box-shadow: 0 6px 18px rgba(0,0,0,.25);
    transition: all .3s ease;
  }
  .program-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 24px rgba(0,0,0,.35);
  }
  .program-card .program-overlay {
    background: linear-gradient(to top, rgba(0,0,0,0.85), rgba(0,0,0,0.5));
    color: #fff;
  }
  .program-card h5 { margin-bottom: .25rem; }
  .program-card ul li { margin-bottom: 4px; }

  /* Pricing cards (subscriptions) */
  .card-pricing {
    background:#fff; border:1px solid #d8efe4; border-radius:14px; padding:24px;
    box-shadow:0 6px 18px rgba(0,0,0,.06); position:relative; transition:all .2s ease;
    display:flex; flex-direction:column;
  }
  .card-pricing:hover { transform:translateY(-4px); box-shadow:0 12px 24px rgba(0,0,0,.08); }
  .plan-title { text-align:center; font-weight:600; color:#16a34a; margin-top:8px; }
  .plan-subtitle { text-align:center; color:#6c757d; font-size:.9rem; }
  .plan-price { text-align:center; margin:16px 0; }
  .plan-price .currency { margin-right:6px; font-weight:700; color:#0f5132; }
  .plan-price .amount { font-size:2rem; font-weight:700; color:#0f5132; }
  .plan-price .per { color:#6c757d; margin-left:6px; }
  .plan-features { list-style:none; padding:0; margin:0 0 20px; }
  .plan-features li { display:flex; gap:8px; align-items:start; padding:4px 0; font-size:.9rem; }
  .card-pricing.featured { border:2px solid #22c55e; box-shadow:0 10px 28px rgba(34,197,94,.25); }
  .card-pricing .most-popular {
    position:absolute; top:-12px; left:50%; transform:translateX(-50%);
    background:#0f5132; color:#fff; font-size:.75rem; padding:4px 10px; border-radius:999px;
  }
</style>
{% endblock %}
